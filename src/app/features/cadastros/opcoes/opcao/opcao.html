<p-card>
    <div class="flex flex-row align-center gap-20">
        <p-button
            icon="pi pi-arrow-left"
            [rounded]="true"
            [text]="true"
            severity="secondary"
            (onClick)="close()"
        />
        <h3 [style]="{ margin: 0 }">
            {{ opcao?.label != null ? 'Editar opção #' + opcao?.id : 'Cadastrar opção' }}
        </h3>
    </div>
</p-card>
<p-card [style]="{ marginTop: '20px' }">
    <div class="flex flex-col gap-20">
        <div class="flex flex-col gap-5">
            <label for="nome">Nome</label>
            <input pInputText id="nome" [(ngModel)]="model.label" />
        </div>

        <div class="div flex justify-between align-center">
            <p>Itens</p>
            <p-button (onClick)="openEditItem(null)" label="Adicionar Item" />
        </div>

        <p-table [value]="model.items" [paginator]="true" [rows]="10">
            <ng-template pTemplate="header">
                <tr>
                    <th>Nome</th>
                    <th>Valor</th>
                    <th>Seleção máxima</th>
                    <th>Auto Selecionado</th>
                    <th>Ações</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-item let-rowIndex="rowIndex">
                <tr>
                    <td>{{ item.label }}</td>
                    <td>{{ item.price }}</td>
                    <td>{{ item.isMultiple ? item.maxSelectedCount : 1 }}</td>
                    <td>
                        {{
                            item.isMultiple
                                ? item.autoSelectedCount
                                : item.autoSelectedCount == 0
                                ? 'Não'
                                : 'Sim'
                        }}
                    </td>
                    <td>
                        <p-button
                            icon="pi pi-check"
                            [rounded]="true"
                            (onClick)="openEditItem(rowIndex)"
                            [text]="true"
                        />
                        <p-button
                            icon="pi pi-times"
                            [rounded]="true"
                            [text]="true"
                            severity="danger"
                            (onClick)="removeItem(rowIndex)"
                        />
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>
</p-card>

@if (editingItem){
<p-drawer
    [showCloseIcon]="false"
    (onHide)="closeEditItem()"
    [(visible)]="editingItem"
    position="right"
    [style]="{ width: '400px' }"
>
    <ng-template #header>
        <h3>{{ editingItem == null ? 'Cadastro de novo item' : 'Edição de item' }}</h3>
    </ng-template>

    <ng-template #content>
        <div class="flex flex-col gap-20">
            <div class="flex flex-col gap-5">
                <label for="nomeItem">Nome</label>
                <input pInputText id="nomeItem" [(ngModel)]="modelItem.label" />
            </div>
            <p-select-button [options]="multipleOptions" [(ngModel)]="modelItem.isMultiple" fluid />
            @if(modelItem.isMultiple){
            <div class="flex flex-col gap-5">
                <p>Seleção máxima</p>
                <div class="flex flex-row align-center gap-20">
                    <p-toggle-switch
                        [(ngModel)]="hasItemLimit"
                        (onChange)="modelItem.maxSelectedCount = 0"
                        size="large"
                    />
                    <p-inputnumber
                        [disabled]="!hasItemLimit"
                        [(ngModel)]="modelItem.maxSelectedCount"
                        [min]="1"
                        style="flex: 1"
                    />
                </div>
            </div>
            <div class="flex flex-col gap-5">
                <p>Seleção automática</p>
                <p-inputnumber
                    [(ngModel)]="modelItem.autoSelectedCount"
                    [min]="0"
                    style="flex: 1"
                />
            </div>
            }@else {
            <div class="flex flex-col gap-5">
                <p>Seleção automática</p>
                <p-select-button
                    [options]="autoSelectedOptions"
                    [(ngModel)]="modelItem.autoSelectedCount"
                    fluid
                />
            </div>
            }
            <div class="flex flex-col gap-5">
                <div class="flex flex-row align-center gap-20">
                    <p-select-button
                        [options]="descontoOptions"
                        [(ngModel)]="modelItem.isDiscount"
                        style="flex: 1"
                    />
                    <p-inputgroup style="flex: 1">
                        <p-inputgroup-addon>R$</p-inputgroup-addon>
                        <p-inputNumber
                            [(ngModel)]="modelItem.price"
                            mode="currency"
                            currency="BRL"
                            locale="pt-BR"
                            [minFractionDigits]="2"
                            [maxFractionDigits]="2"
                            [required]="true"
                        >
                        </p-inputNumber>
                    </p-inputgroup>
                </div>
            </div>
        </div>
    </ng-template>

    <ng-template #footer>
        <div class="flex flex-row gap-20 editing-item-buttons">
            <p-button (onClick)="closeEditItem()" severity="secondary" label="Cancelar" />
            <p-button (onClick)="editItem()" type="button" label="Salvar" />
        </div>
    </ng-template>
</p-drawer>
}
